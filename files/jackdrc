#!/bin/sh
# JACK with realtime priority (RT scheduler manages CPU allocation)
set -e

# Load user configuration from /etc/default/jack (set via /boot/pistomp.conf)
if [ ! -f /etc/default/jack ]; then
    echo "ERROR: /etc/default/jack not found. Did firstboot.sh run?" >&2
    exit 1
fi

. /etc/default/jack

# Verify required settings
if [ -z "${JACK_SAMPLE_RATE}" ] || [ -z "${JACK_PERIOD}" ]; then
    echo "ERROR: JACK_SAMPLE_RATE or JACK_PERIOD not set in /etc/default/jack" >&2
    exit 2
fi

exec /usr/bin/jackd -t 2000 -R -P 75 -d alsa -d hw:0 -r "${JACK_SAMPLE_RATE}" -p "${JACK_PERIOD}" -n 2 -X seq -s
